# Характеристики оборудования для тестов #
 |||
-------------------|-
**Compiler**           | g++ 11.3.0 
**OS**                 | Ubuntu 11.3.0 
**CPU**                | 11th Gen Intel(R) Core(TM) i7-1165G7 @ 2.80GHz

# Визуализация множества Мандельброта #

Напишем визуализацию множества Мандельброта, затем переорганизуем код и встроим в него intrinsic функции. Применим сначала SSE инструкции, а после - AVX512 инструкции. Сравним скорость работы.

Ознакомится с алгоритмом расчёта множества Мандельброта можно по [этой ссылке](https://en.wikipedia.org/wiki/Plotting_algorithms_for_the_Mandelbrot_set) 
![Mandelbrot set](/Output/MandelbrotImage.png)

## Результаты измерений ##

Версия  | Этап                                                       | FPS            | +-       | Коэффициент  
--------|------------------------------------------------------------|:--------------:|:--------:|:------------------
1.0     | Наивный алгоритм буз оптимизаций + debug флаги             | **6**          |**1.6%**  |**50%**       
1.1     | Версия 1.0 + флаги -O2 и -msse4                            | **12**         |**2.5%**  |**100%**      
2.0     | Во внутреннем цикле теперь обрабатываются по 4 точки       | **0.12**       |**0.17%** |**1%**        
2.1     | Версия 2.0 + флаги -O2 и -msse4                            | **2.4**        |**2.1%**  |**20%**        
3.0     | Каждый цикл for(i = 0, ..., 3) помещён в отдельную функцию | **0.075**      |**0.4%**  |**0.625%**      
3.1     | Версия 3.0 + флаги -O2 и -msse4                            | **1.6**        |**1.25%** |**13%**          
4       | Использованы sse intrinsic функции + флаги -O2 и -msse4    | **44**         |**1.14%** |**366.6%**      
5       | Использованы avx512 intrinsic функции                      | **140**        |**0.29%** |**1166.6%**     

## Анализ ##

По таблице хорошо видно, что даже в переорганизованном коде, в котором каждое место для применения intrinsic функций вынесено в отдельную функцию, компилятор не подставляет intrinsic инструкции. 
Теоретический придел роста производительности при применении sse функций - 4 раза, avx - 16. Обусловлено это тем, что в 128-ми битной переменной помещаются 4 float-а, а в 512-ти битной - 16. Соответственно за одну итерацию алгоритма происходит пересчёт сразу 4, в SSE случае и 16, в AVX случае, точек. Но фактически скорость работы увеличилась в 3.6 раза для SSE и 11.6 раза для
AVX. Отставание от теоретического максимума обусловлено следующим фактором:

Может оказаться, что некоторые точки из выбранных для расчётов, выходят из радиуса раньше других. Тогда наивный алгоритм для этих точек закончится раньше, а алгоритмы с intrinsic функциями будут совершать расчёты для всех точек, пока хотя бы одна из них не выйдет из окружности или пока не будет произведено более заранее фиксированного числа шагов алгоритма. 

# Alpha blending #

Реализуем алгоритм альфа-блендинга и оптимизируем его, используя AVX512 intrinsic функции, чтобы рассчитывать за одну итерацию сразу несколько пикселей.

## Результаты измерений ##

Этап                                                            | FPS      |    +-     | Коэффициент  
----------------------------------------------------------------|:---------|-----------|:------------
 Наивная реализация   + -O0                                     | **37.1** | **1.1%**  | **0.21**   
 AVX512 + невыровненные инструкций загрузки и сохранения + -O0  | **149**  | **0.2%**  | **0.84**   
 AVX512 + выровненные   инструкций загрузки и сохранения + -O0  | **144**  | **2.2%**  | **0.81**   
 Наивная реализация + -O2                                       | **176**  | **1.5%**  | **1**
 Наивная реализация + -O2 и -march=tigerlake флаги              | **181**  | **2.1%**  | **1.03**
 AVX512 + невыровненные инструкций загрузки и сохранения + -O2  | **558**  | **2%**    | **3.17** 
 AVX512 + выровненные   инструкций загрузки и сохранения + -O2  | **606**  | **0.1%**  | **3.44**  

## Анализ ##

В этом случае сборки программы с флагом -O0 AVX512 intrinsic функции ускорили программу в 4 раза. В случае сборки с оптимизирующими флагами прирост производительности падает и составляет только 3 раза. Чем вызвано такое падение? 